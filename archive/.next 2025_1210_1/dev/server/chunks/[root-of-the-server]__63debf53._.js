module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/querystring [external] (querystring, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/zlib [external] (zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/process [external] (process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/timers [external] (timers, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("timers", () => require("timers"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[project]/frontend2.4/lib/db/mysql-primary.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getMySQLPrimaryPool",
    ()=>getMySQLPrimaryPool,
    "getUsers",
    ()=>getUsers,
    "queryPrimary",
    ()=>queryPrimary,
    "testMySQLPrimaryConnection",
    ()=>testMySQLPrimaryConnection
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/mysql2/promise.js [app-route] (ecmascript)");
;
let pool = null;
function getMySQLPrimaryPool() {
    if (!pool) {
        pool = __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createPool({
            host: process.env.DB_MYSQL_PRIMARY_HOST,
            port: parseInt(process.env.DB_MYSQL_PRIMARY_PORT || '3306'),
            user: process.env.DB_MYSQL_PRIMARY_USER,
            password: process.env.DB_MYSQL_PRIMARY_PASSWORD,
            database: process.env.DB_MYSQL_PRIMARY_DATABASE,
            waitForConnections: true,
            connectionLimit: 10,
            queueLimit: 0,
            enableKeepAlive: true,
            keepAliveInitialDelay: 0
        });
    }
    return pool;
}
async function queryPrimary(sql, params) {
    const pool = getMySQLPrimaryPool();
    const [rows] = await pool.execute(sql, params);
    return rows;
}
async function testMySQLPrimaryConnection() {
    try {
        const pool = getMySQLPrimaryPool();
        const connection = await pool.getConnection();
        await connection.ping();
        connection.release();
        return {
            success: true,
            message: 'MySQL Primary connected'
        };
    } catch (error) {
        return {
            success: false,
            message: `MySQL Primary error: ${error}`
        };
    }
}
async function getUsers() {
    return queryPrimary(`SELECT 
      id,
      username,
      name,
      email,
      nickname,
      phone,
      mobile,
      title,
      role,
      active
    FROM Users 
    WHERE active = 1
    ORDER BY name ASC`);
}
}),
"[project]/frontend2.4/lib/auth.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "authOptions",
    ()=>authOptions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/next-auth/providers/credentials.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/bcryptjs/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$primary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/lib/db/mysql-primary.ts [app-route] (ecmascript)");
;
;
;
const authOptions = {
    providers: [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2d$auth$2f$providers$2f$credentials$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            name: 'Credentials',
            credentials: {
                username: {
                    label: 'Username',
                    type: 'text'
                },
                password: {
                    label: 'Password',
                    type: 'password'
                }
            },
            async authorize (credentials) {
                if (!credentials?.username || !credentials?.password) {
                    return null;
                }
                try {
                    // Get user
                    const users = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$primary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["queryPrimary"])('SELECT * FROM Users WHERE username = ? AND active = 1', [
                        credentials.username
                    ]);
                    const user = users[0];
                    if (!user || !user.password) {
                        return null;
                    }
                    // Verify password
                    const isValid = await __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$bcryptjs$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].compare(credentials.password, user.password);
                    if (!isValid) {
                        return null;
                    }
                    // Get user roles
                    const roles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$primary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["queryPrimary"])(`SELECT r.id, r.name 
             FROM roles r
             INNER JOIN user_roles ur ON r.id = ur.roleId
             WHERE ur.userId = ?`, [
                        user.id
                    ]);
                    const roleNames = roles.map((r)=>r.name);
                    return {
                        id: user.id.toString(),
                        name: user.name || user.username,
                        email: user.email || '',
                        username: user.username,
                        roles: roleNames
                    };
                } catch (error) {
                    console.error('Auth error:', error);
                    return null;
                }
            }
        })
    ],
    callbacks: {
        async jwt ({ token, user }) {
            if (user) {
                token.id = user.id;
                token.username = user.username;
                token.roles = user.roles;
            }
            return token;
        },
        async session ({ session, token }) {
            if (session.user) {
                session.user.id = token.id;
                session.user.username = token.username;
                session.user.roles = token.roles;
                // Create initials from name
                const nameParts = session.user.name?.split(' ') || [
                    'U'
                ];
                session.user.initials = nameParts.length > 1 ? `${nameParts[0][0]}${nameParts[1][0]}`.toUpperCase() : nameParts[0].substring(0, 2).toUpperCase();
            }
            return session;
        }
    },
    pages: {
        signIn: '/login'
    },
    session: {
        strategy: 'jwt',
        maxAge: 30 * 24 * 60 * 60
    },
    secret: process.env.NEXTAUTH_SECRET
};
}),
"[project]/frontend2.4/lib/db/mysql-secondary.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getMySQLSecondaryPool",
    ()=>getMySQLSecondaryPool,
    "querySecondary",
    ()=>querySecondary
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/mysql2/promise.js [app-route] (ecmascript)");
;
let pool = null;
function getMySQLSecondaryPool() {
    if (!pool) {
        pool = __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mysql2$2f$promise$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].createPool({
            host: process.env.DB_MYSQL_SECONDARY_HOST,
            port: parseInt(process.env.DB_MYSQL_SECONDARY_PORT || '3306'),
            user: process.env.DB_MYSQL_SECONDARY_USER,
            password: process.env.DB_MYSQL_SECONDARY_PASSWORD,
            database: process.env.DB_MYSQL_SECONDARY_DATABASE,
            waitForConnections: true,
            connectionLimit: 10,
            queueLimit: 0
        });
    }
    return pool;
}
async function querySecondary(sql, params) {
    const pool = getMySQLSecondaryPool();
    const [rows] = await pool.execute(sql, params);
    return rows;
}
}),
"[project]/frontend2.4/app/api/admin/job-notes/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "GET",
    ()=>GET,
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/next-auth/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/lib/auth.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$secondary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/lib/db/mysql-secondary.ts [app-route] (ecmascript)");
;
;
;
;
// Helper to parse date from day/month/year columns
function parseDate(day, month, year) {
    if (!day || !month || !year) return null;
    const monthMap = {
        'Jan': '01',
        'Feb': '02',
        'Mar': '03',
        'Apr': '04',
        'May': '05',
        'Jun': '06',
        'Jul': '07',
        'Aug': '08',
        'Sep': '09',
        'Oct': '10',
        'Nov': '11',
        'Dec': '12'
    };
    const monthNum = monthMap[month] || month;
    const dayPadded = day.toString().padStart(2, '0');
    return `${year}-${monthNum}-${dayPadded}`;
}
// Helper to extract date or "Complete" from notes field
// Looks for patterns like [CAM: 10/10/2025] or [CAM: Complete]
function extractDateFromNotes(notes, tag) {
    if (!notes) return {
        date: null,
        complete: false
    };
    // Match pattern like [TAG: value] or [TAG:value]
    const regex = new RegExp(`\\[${tag}:\\s*([^\\]]+)\\]`, 'i');
    const match = notes.match(regex);
    if (!match) return {
        date: null,
        complete: false
    };
    const value = match[1].trim();
    if (value.toLowerCase() === 'complete') {
        return {
            date: null,
            complete: true
        };
    }
    // Try to parse as date (MM/DD/YYYY format)
    const dateMatch = value.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/);
    if (dateMatch) {
        const [, month, day, year] = dateMatch;
        return {
            date: `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`,
            complete: false
        };
    }
    return {
        date: null,
        complete: false
    };
}
// Helper to extract section text and hold info from notes
// Looks for [TAG] followed by text until the next [TAG] or end
// Also parses [Owner: X; Target: Y; Action: Z] within the section
// And parses [On Hold: date] and [Days On Hold: X]
function extractSectionFromNotes(notes, tag) {
    if (!notes) return {
        text: '',
        hasHold: false,
        owner: null,
        target: null,
        action: null,
        onHoldDate: null,
        daysOnHold: 0
    };
    // Find the section starting with [TAG]
    const sectionRegex = new RegExp(`\\[${tag}\\]\\s*([\\s\\S]*?)(?=\\n\\[(?!Owner|On Hold|Days On Hold)|$)`, 'i');
    const sectionMatch = notes.match(sectionRegex);
    if (!sectionMatch) return {
        text: '',
        hasHold: false,
        owner: null,
        target: null,
        action: null,
        onHoldDate: null,
        daysOnHold: 0
    };
    let sectionText = sectionMatch[1].trim();
    // Check for hold information: [Owner: X; Target: Y; Action: Z]
    const holdRegex = /\[Owner:\s*([^;]+);\s*Target:\s*([^;]+);\s*Action:\s*([^\]]+)\]/i;
    const holdMatch = sectionText.match(holdRegex);
    let owner = null;
    let target = null;
    let action = null;
    let hasHold = false;
    if (holdMatch) {
        hasHold = true;
        owner = holdMatch[1].trim();
        // Parse target date (MM/DD/YYYY format)
        const targetStr = holdMatch[2].trim();
        const targetDateMatch = targetStr.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})/);
        if (targetDateMatch) {
            const [, month, day, year] = targetDateMatch;
            target = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        }
        action = holdMatch[3].trim();
        // Remove the hold bracket from the text for cleaner display
        sectionText = sectionText.replace(holdRegex, '').trim();
    }
    // Parse [On Hold: MM/DD/YYYY]
    let onHoldDate = null;
    const onHoldRegex = /\[On Hold:\s*(\d{1,2})\/(\d{1,2})\/(\d{4})\]/i;
    const onHoldMatch = sectionText.match(onHoldRegex);
    if (onHoldMatch) {
        const [, month, day, year] = onHoldMatch;
        onHoldDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
        sectionText = sectionText.replace(onHoldRegex, '').trim();
    }
    // Parse [Days On Hold: X]
    let daysOnHold = 0;
    const daysOnHoldRegex = /\[Days On Hold:\s*(\d+)\]/i;
    const daysOnHoldMatch = sectionText.match(daysOnHoldRegex);
    if (daysOnHoldMatch) {
        daysOnHold = parseInt(daysOnHoldMatch[1], 10);
        sectionText = sectionText.replace(daysOnHoldRegex, '').trim();
    }
    // Clean up the text - remove extra whitespace and newlines
    sectionText = sectionText.replace(/\s+/g, ' ').trim();
    return {
        text: sectionText,
        hasHold,
        owner,
        target,
        action,
        onHoldDate,
        daysOnHold
    };
}
async function GET(request) {
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
    if (!session) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Unauthorized'
        }, {
            status: 401
        });
    }
    try {
        const { searchParams } = new URL(request.url);
        const jobName = searchParams.get('jobName');
        if (!jobName) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'jobName parameter is required'
            }, {
                status: 400
            });
        }
        const query = `
      SELECT 
        umj.id,
        umj.job_id,
        umj.notes,
        umj.time_stamp,
        umj.hdw_comp_day,
        umj.hdw_comp_month,
        umj.hdw_comp_year,
        umj.bom_comp_day,
        umj.bom_comp_month,
        umj.bom_comp_year,
        umj.pcb_comp_day,
        umj.pcb_comp_month,
        umj.pcb_comp_year,
        umj.asm_comp_day,
        umj.asm_comp_month,
        umj.asm_comp_year
      FROM job 
      JOIN umr_job_status_notes umj ON job.id = umj.job_id
      WHERE job.name = ?
      ORDER BY umj.time_stamp DESC
    `;
        const results = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$secondary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["querySecondary"])(query, [
            jobName
        ]);
        // Transform results
        const notes = results.map((row)=>{
            const cam = extractDateFromNotes(row.notes, 'CAM');
            const rev = extractDateFromNotes(row.notes, 'Rev');
            // Extract section text and hold info
            const hdwSection = extractSectionFromNotes(row.notes, 'HDW');
            const pcbSection = extractSectionFromNotes(row.notes, 'PCB');
            const asmSection = extractSectionFromNotes(row.notes, 'ASM');
            // Format timestamp
            const timestampMs = row.time_stamp * 1000;
            const timestampDate = new Date(timestampMs);
            const timestampFormatted = timestampDate.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            return {
                id: row.id,
                job_id: row.job_id,
                timestamp: row.time_stamp,
                timestampFormatted,
                notes: row.notes || '',
                hdw_date: parseDate(row.hdw_comp_day, row.hdw_comp_month, row.hdw_comp_year),
                bom_date: parseDate(row.bom_comp_day, row.bom_comp_month, row.bom_comp_year),
                cam_date: cam.date,
                cam_complete: cam.complete,
                rev_date: rev.date,
                rev_complete: rev.complete,
                prl_date: parseDate(row.pcb_comp_day, row.pcb_comp_month, row.pcb_comp_year),
                arl_date: parseDate(row.asm_comp_day, row.asm_comp_month, row.asm_comp_year),
                hdw_text: hdwSection.text,
                hdw_hold: {
                    hasHold: hdwSection.hasHold,
                    owner: hdwSection.owner,
                    target: hdwSection.target,
                    action: hdwSection.action,
                    onHoldDate: hdwSection.onHoldDate,
                    daysOnHold: hdwSection.daysOnHold
                },
                pcb_text: pcbSection.text,
                pcb_hold: {
                    hasHold: pcbSection.hasHold,
                    owner: pcbSection.owner,
                    target: pcbSection.target,
                    action: pcbSection.action,
                    onHoldDate: pcbSection.onHoldDate,
                    daysOnHold: pcbSection.daysOnHold
                },
                asm_text: asmSection.text,
                asm_hold: {
                    hasHold: asmSection.hasHold,
                    owner: asmSection.owner,
                    target: asmSection.target,
                    action: asmSection.action,
                    onHoldDate: asmSection.onHoldDate,
                    daysOnHold: asmSection.daysOnHold
                }
            };
        });
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            jobName,
            count: notes.length,
            notes
        });
    } catch (error) {
        console.error('Job Notes API Error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to fetch job notes',
            details: error instanceof Error ? error.message : String(error)
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    const session = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2d$auth$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getServerSession"])(__TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$auth$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["authOptions"]);
    if (!session) {
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Unauthorized'
        }, {
            status: 401
        });
    }
    try {
        const body = await request.json();
        const { jobName, notes, hdw_date, bom_date, prl_date, arl_date } = body;
        if (!jobName) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'jobName is required'
            }, {
                status: 400
            });
        }
        // First get the job_id
        const jobQuery = `SELECT id FROM job WHERE name = ? LIMIT 1`;
        const jobResults = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$secondary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["querySecondary"])(jobQuery, [
            jobName
        ]);
        if (jobResults.length === 0) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Job not found'
            }, {
                status: 404
            });
        }
        const jobId = jobResults[0].id;
        // Parse dates into day/month/year
        const parseDateParts = (dateStr)=>{
            if (!dateStr) return {
                day: null,
                month: null,
                year: null
            };
            const date = new Date(dateStr);
            const months = [
                'Jan',
                'Feb',
                'Mar',
                'Apr',
                'May',
                'Jun',
                'Jul',
                'Aug',
                'Sep',
                'Oct',
                'Nov',
                'Dec'
            ];
            return {
                day: date.getDate().toString().padStart(2, '0'),
                month: months[date.getMonth()],
                year: date.getFullYear().toString()
            };
        };
        const hdw = parseDateParts(hdw_date);
        const bom = parseDateParts(bom_date);
        const prl = parseDateParts(prl_date);
        const arl = parseDateParts(arl_date);
        const insertQuery = `
      INSERT INTO umr_job_status_notes (
        job_id, notes, time_stamp,
        hdw_comp_day, hdw_comp_month, hdw_comp_year,
        bom_comp_day, bom_comp_month, bom_comp_year,
        pcb_comp_day, pcb_comp_month, pcb_comp_year,
        asm_comp_day, asm_comp_month, asm_comp_year
      ) VALUES (?, ?, UNIX_TIMESTAMP(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `;
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$lib$2f$db$2f$mysql$2d$secondary$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["querySecondary"])(insertQuery, [
            jobId,
            notes || '',
            hdw.day,
            hdw.month,
            hdw.year,
            bom.day,
            bom.month,
            bom.year,
            prl.day,
            prl.month,
            prl.year,
            arl.day,
            arl.month,
            arl.year
        ]);
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            message: 'Job status note created'
        });
    } catch (error) {
        console.error('Job Notes POST Error:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to create job note',
            details: error instanceof Error ? error.message : String(error)
        }, {
            status: 500
        });
    }
}
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__63debf53._.js.map