module.exports = [
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/@opentelemetry/api [external] (next/dist/compiled/@opentelemetry/api, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/@opentelemetry/api", () => require("next/dist/compiled/@opentelemetry/api"));

module.exports = mod;
}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/shared/lib/no-fallback-error.external.js [external] (next/dist/shared/lib/no-fallback-error.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/shared/lib/no-fallback-error.external.js", () => require("next/dist/shared/lib/no-fallback-error.external.js"));

module.exports = mod;
}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}),
"[externals]/node:events [external] (node:events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}),
"[externals]/tty [external] (tty, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}),
"[externals]/util [external] (util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}),
"[externals]/os [external] (os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}),
"[externals]/events [external] (events, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}),
"[externals]/timers [external] (timers, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("timers", () => require("timers"));

module.exports = mod;
}),
"[externals]/node:stream [external] (node:stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:stream", () => require("node:stream"));

module.exports = mod;
}),
"[externals]/stream [external] (stream, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}),
"[externals]/crypto [external] (crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}),
"[externals]/tls [external] (tls, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}),
"[externals]/net [external] (net, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}),
"[externals]/dns [external] (dns, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}),
"[externals]/constants [external] (constants, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("constants", () => require("constants"));

module.exports = mod;
}),
"[externals]/node:os [external] (node:os, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:os", () => require("node:os"));

module.exports = mod;
}),
"[externals]/node:util [external] (node:util, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}),
"[externals]/node:process [external] (node:process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}),
"[externals]/node:crypto [external] (node:crypto, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}),
"[externals]/node:http [external] (node:http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:http", () => require("node:http"));

module.exports = mod;
}),
"[externals]/node:https [external] (node:https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:https", () => require("node:https"));

module.exports = mod;
}),
"[externals]/node:zlib [external] (node:zlib, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:zlib", () => require("node:zlib"));

module.exports = mod;
}),
"[externals]/assert [external] (assert, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}),
"[externals]/http [external] (http, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}),
"[externals]/https [external] (https, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}),
"[externals]/url [external] (url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}),
"[externals]/buffer [external] (buffer, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}),
"[externals]/fs [external] (fs, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}),
"[externals]/path [external] (path, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}),
"[externals]/node:fs/promises [external] (node:fs/promises, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:fs/promises", () => require("node:fs/promises"));

module.exports = mod;
}),
"[externals]/child_process [external] (child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}),
"[externals]/node:child_process [external] (node:child_process, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:child_process", () => require("node:child_process"));

module.exports = mod;
}),
"[externals]/dgram [external] (dgram, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("dgram", () => require("dgram"));

module.exports = mod;
}),
"[externals]/node:url [external] (node:url, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("node:url", () => require("node:url"));

module.exports = mod;
}),
"[externals]/string_decoder [external] (string_decoder, cjs)", ((__turbopack_context__, module, exports) => {

const mod = __turbopack_context__.x("string_decoder", () => require("string_decoder"));

module.exports = mod;
}),
"[project]/frontend2.4/app/api/products/bom/route.ts [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "POST",
    ()=>POST
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mssql$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/frontend2.4/node_modules/mssql/index.js [app-route] (ecmascript)");
;
;
// Production Database Connection (SQL Server)
const config = {
    server: process.env.PRODUCTION_DB_HOST || '',
    database: process.env.PRODUCTION_DB_NAME || '',
    user: process.env.PRODUCTION_DB_USER || '',
    password: process.env.PRODUCTION_DB_PASSWORD || '',
    options: {
        encrypt: true,
        trustServerCertificate: true // For local dev
    }
};
async function POST(request) {
    try {
        const { apcPN, level = 0, isInventoryPart = false } = await request.json();
        if (!apcPN) {
            return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'apcPN is required'
            }, {
                status: 400
            });
        }
        // Connect to SQL Server
        const pool = await __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mssql$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].connect(config);
        let result;
        // Two different queries depending on if this is a customer part or inventory part
        if (isInventoryPart) {
            // For inventory parts (manufactured parts from data0017)
            result = await pool.request().input('apcPN', __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mssql$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].VarChar, apcPN).query(`
          SELECT 
            d17.INV_PART_NUMBER AS parent_part,
            d17.P_M AS parent_type,
            d25.RKEY AS bom_header_key,
            d25.EFF_END AS eff_end,
            d26.QTY_BOM AS quantity,
            d26.UNIT_PTR AS unit_ptr,
            d26.REFERENCE_DESIGNATORS AS ref_des,
            d26.SEQUENCE AS sequence,
            d17_1.INV_PART_NUMBER AS component_part,
            d17_1.DESCRIPTION AS description,
            d17_1.P_M AS component_type,
            d17_1.RKEY AS component_rkey,
            CASE WHEN d17_1.P_M = 'M' THEN 1 ELSE 0 END AS has_children
          FROM data0017 d17
          JOIN data0025 d25 ON d17.RKEY = d25.INVENTORY_PTR
          JOIN data0026 d26 ON d25.RKEY = d26.PARENT_NODE_INVENT
          JOIN data0017 d17_1 ON d17_1.RKEY = d26.INVENTORY_PTR
          WHERE d17.INV_PART_NUMBER = @apcPN
            AND d17.P_M = 'M'
            AND (d25.EFF_END IS NULL OR d25.EFF_END > GETDATE())
          ORDER BY d26.SEQUENCE, d17_1.INV_PART_NUMBER
        `);
        } else {
            // For customer parts (from data0050)
            result = await pool.request().input('apcPN', __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$mssql$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"].VarChar, `${apcPN}%`).query(`
          SELECT 
            d50.CUSTOMER_PART_NUMBER AS parent_part,
            'C' AS parent_type,
            d25.RKEY AS bom_header_key,
            d25.EFF_END AS eff_end,
            d26.QTY_BOM AS quantity,
            d26.UNIT_PTR AS unit_ptr,
            d26.REFERENCE_DESIGNATORS AS ref_des,
            d26.SEQUENCE AS sequence,
            d17.INV_PART_NUMBER AS component_part,
            d17.DESCRIPTION AS description,
            d17.P_M AS component_type,
            d17.RKEY AS component_rkey,
            CASE WHEN d17.P_M = 'M' THEN 1 ELSE 0 END AS has_children
          FROM data0050 d50
          JOIN data0025 d25 ON d50.BOM_PTR = d25.RKEY
          JOIN data0026 d26 ON d25.RKEY = d26.PARENT_NODE_INVENT
          JOIN data0017 d17 ON d26.INVENTORY_PTR = d17.RKEY
          WHERE d50.CUSTOMER_PART_NUMBER LIKE @apcPN
            AND (d25.EFF_END IS NULL OR d25.EFF_END > GETDATE())
          ORDER BY d26.SEQUENCE, d17.INV_PART_NUMBER
        `);
        }
        const rows = result.recordset;
        console.log(`BOM Query for ${apcPN} (${isInventoryPart ? 'Inventory' : 'Customer'} part): Found ${rows.length} components`);
        // Transform results to match BOMItem type
        const results = rows.map((row, index)=>({
                id: `${row.component_part}-${level}-${index}`,
                part_number: row.component_part,
                description: row.description || '',
                quantity: parseFloat(row.quantity) || 0,
                ref_des: row.ref_des || '',
                unit: row.unit_ptr || '',
                level: level,
                has_children: Boolean(row.has_children),
                parent_part: row.parent_part,
                component_type: row.component_type,
                sequence: row.sequence,
                eff_end: row.eff_end
            }));
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            success: true,
            results,
            count: results.length,
            debug: {
                partNumber: apcPN,
                isInventoryPart,
                level
            }
        });
    } catch (error) {
        console.error('Error fetching BOM data:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$frontend2$2e$4$2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Failed to fetch BOM data',
            details: error instanceof Error ? error.message : 'Unknown error'
        }, {
            status: 500
        });
    }
} /* ============================================
   SCHEMA UNDERSTANDING
   ============================================
   
   TWO TYPES OF PARTS:
   
   1. CUSTOMER PARTS (data0050)
      - CUSTOMER_PART_NUMBER (unique ID)
      - BOM_PTR → points to data0025.RKEY
      - These are assemblies for customers
   
   2. INVENTORY PARTS (data0017)
      - INV_PART_NUMBER (unique ID)
      - P_M flag: 'P' = Purchased, 'M' = Manufactured
      - RKEY (primary key)
      - If P_M = 'M', part has a BOM
   
   BOM STRUCTURE:
   
   data0025 - BOM Headers
     - RKEY (primary key)
     - INVENTORY_PTR → points to data0017.RKEY (for manufactured parts)
     - EFF_END (effectivity date)
   
   data0026 - BOM Line Items (components)
     - PARENT_NODE_INVENT → points to data0025.RKEY
     - INVENTORY_PTR → points to data0017.RKEY (the component)
     - QTY_BOM (quantity needed)
     - REFERENCE_DESIGNATORS
     - SEQUENCE (sort order)
   
   RELATIONSHIPS:
   
   Customer Part BOM:
   data0050 → (BOM_PTR) → data0025 → (PARENT_NODE_INVENT) → data0026 → (INVENTORY_PTR) → data0017
   
   Manufactured Part BOM:
   data0017 → (INVENTORY_PTR) → data0025 → (PARENT_NODE_INVENT) → data0026 → (INVENTORY_PTR) → data0017
   
   ============================================
   TREE NAVIGATION LOGIC
   ============================================
   
   1. Start with customer part (e.g., "12034 REV A")
   2. Query returns components from data0017
   3. For each component, check P_M:
      - If P_M = 'P': Purchased part (leaf node, no children)
      - If P_M = 'M': Manufactured part (has_children = true)
   4. When user expands a manufactured component:
      - Call API again with INV_PART_NUMBER
      - Set isInventoryPart = true
      - Uses second query to find its BOM
   5. Repeat recursively for nested assemblies
   
   ============================================ */ 
}),
];

//# sourceMappingURL=%5Broot-of-the-server%5D__e2a896d2._.js.map