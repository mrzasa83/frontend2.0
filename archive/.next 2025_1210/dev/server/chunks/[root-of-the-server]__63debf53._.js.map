{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 142, "column": 0}, "map": {"version":3,"sources":["file:///users/mrzasa/projects/current/frontend2.4/lib/db/mysql-primary.ts"],"sourcesContent":["import mysql from 'mysql2/promise'\r\n\r\nlet pool: mysql.Pool | null = null\r\n\r\nexport function getMySQLPrimaryPool() {\r\n  if (!pool) {\r\n    pool = mysql.createPool({\r\n      host: process.env.DB_MYSQL_PRIMARY_HOST,\r\n      port: parseInt(process.env.DB_MYSQL_PRIMARY_PORT || '3306'),\r\n      user: process.env.DB_MYSQL_PRIMARY_USER,\r\n      password: process.env.DB_MYSQL_PRIMARY_PASSWORD,\r\n      database: process.env.DB_MYSQL_PRIMARY_DATABASE,\r\n      waitForConnections: true,\r\n      connectionLimit: 10,\r\n      queueLimit: 0,\r\n      enableKeepAlive: true,\r\n      keepAliveInitialDelay: 0\r\n    })\r\n  }\r\n  return pool\r\n}\r\n\r\nexport async function queryPrimary<T = any>(\r\n  sql: string,\r\n  params?: any[]\r\n): Promise<T> {\r\n  const pool = getMySQLPrimaryPool()\r\n  const [rows] = await pool.execute(sql, params)\r\n  return rows as T\r\n}\r\n\r\n// Test connection\r\nexport async function testMySQLPrimaryConnection() {\r\n  try {\r\n    const pool = getMySQLPrimaryPool()\r\n    const connection = await pool.getConnection()\r\n    await connection.ping()\r\n    connection.release()\r\n    return { success: true, message: 'MySQL Primary connected' }\r\n  } catch (error) {\r\n    return { success: false, message: `MySQL Primary error: ${error}` }\r\n  }\r\n}\r\n\r\n// At the end of mysql-primary.ts\r\nexport async function getUsers() {\r\n  return queryPrimary<any[]>(\r\n    `SELECT \r\n      id,\r\n      username,\r\n      name,\r\n      email,\r\n      nickname,\r\n      phone,\r\n      mobile,\r\n      title,\r\n      role,\r\n      active\r\n    FROM Users \r\n    WHERE active = 1\r\n    ORDER BY name ASC`\r\n  )\r\n}"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,IAAI,OAA0B;AAEvB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,gKAAK,CAAC,UAAU,CAAC;YACtB,MAAM,QAAQ,GAAG,CAAC,qBAAqB;YACvC,MAAM,SAAS,QAAQ,GAAG,CAAC,qBAAqB,IAAI;YACpD,MAAM,QAAQ,GAAG,CAAC,qBAAqB;YACvC,UAAU,QAAQ,GAAG,CAAC,yBAAyB;YAC/C,UAAU,QAAQ,GAAG,CAAC,yBAAyB;YAC/C,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;YACZ,iBAAiB;YACjB,uBAAuB;QACzB;IACF;IACA,OAAO;AACT;AAEO,eAAe,aACpB,GAAW,EACX,MAAc;IAEd,MAAM,OAAO;IACb,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACvC,OAAO;AACT;AAGO,eAAe;IACpB,IAAI;QACF,MAAM,OAAO;QACb,MAAM,aAAa,MAAM,KAAK,aAAa;QAC3C,MAAM,WAAW,IAAI;QACrB,WAAW,OAAO;QAClB,OAAO;YAAE,SAAS;YAAM,SAAS;QAA0B;IAC7D,EAAE,OAAO,OAAO;QACd,OAAO;YAAE,SAAS;YAAO,SAAS,CAAC,qBAAqB,EAAE,OAAO;QAAC;IACpE;AACF;AAGO,eAAe;IACpB,OAAO,aACL,CAAC;;;;;;;;;;;;;qBAagB,CAAC;AAEtB","debugId":null}},
    {"offset": {"line": 214, "column": 0}, "map": {"version":3,"sources":["file:///users/mrzasa/projects/current/frontend2.4/lib/auth.ts"],"sourcesContent":["import { NextAuthOptions } from 'next-auth'\r\nimport CredentialsProvider from 'next-auth/providers/credentials'\r\nimport bcrypt from 'bcryptjs'\r\nimport { queryPrimary } from './db/mysql-primary'\r\n\r\ninterface User {\r\n  id: number\r\n  username: string\r\n  name: string | null\r\n  email: string | null\r\n  password: string\r\n  active: number | null\r\n}\r\n\r\ninterface Role {\r\n  id: number\r\n  name: string\r\n}\r\n\r\nexport const authOptions: NextAuthOptions = {\r\n  providers: [\r\n    CredentialsProvider({\r\n      name: 'Credentials',\r\n      credentials: {\r\n        username: { label: 'Username', type: 'text' },\r\n        password: { label: 'Password', type: 'password' }\r\n      },\r\n      async authorize(credentials) {\r\n        if (!credentials?.username || !credentials?.password) {\r\n          return null\r\n        }\r\n\r\n        try {\r\n          // Get user\r\n          const users = await queryPrimary<User[]>(\r\n            'SELECT * FROM Users WHERE username = ? AND active = 1',\r\n            [credentials.username]\r\n          )\r\n\r\n          const user = users[0]\r\n\r\n          if (!user || !user.password) {\r\n            return null\r\n          }\r\n\r\n          // Verify password\r\n          const isValid = await bcrypt.compare(credentials.password, user.password)\r\n\r\n          if (!isValid) {\r\n            return null\r\n          }\r\n\r\n          // Get user roles\r\n          const roles = await queryPrimary<Role[]>(\r\n            `SELECT r.id, r.name \r\n             FROM roles r\r\n             INNER JOIN user_roles ur ON r.id = ur.roleId\r\n             WHERE ur.userId = ?`,\r\n            [user.id]\r\n          )\r\n\r\n          const roleNames = roles.map(r => r.name)\r\n\r\n          return {\r\n            id: user.id.toString(),\r\n            name: user.name || user.username,\r\n            email: user.email || '',\r\n            username: user.username,\r\n            roles: roleNames\r\n          }\r\n        } catch (error) {\r\n          console.error('Auth error:', error)\r\n          return null\r\n        }\r\n      }\r\n    })\r\n  ],\r\n  callbacks: {\r\n    async jwt({ token, user }) {\r\n      if (user) {\r\n        token.id = user.id\r\n        token.username = user.username\r\n        token.roles = user.roles\r\n      }\r\n      return token\r\n    },\r\n    async session({ session, token }) {\r\n      if (session.user) {\r\n        session.user.id = token.id as string\r\n        session.user.username = token.username as string\r\n        session.user.roles = token.roles as string[]\r\n        \r\n        // Create initials from name\r\n        const nameParts = session.user.name?.split(' ') || ['U']\r\n        session.user.initials = nameParts.length > 1 \r\n          ? `${nameParts[0][0]}${nameParts[1][0]}`.toUpperCase()\r\n          : nameParts[0].substring(0, 2).toUpperCase()\r\n      }\r\n      return session\r\n    }\r\n  },\r\n  pages: {\r\n    signIn: '/login',\r\n  },\r\n  session: {\r\n    strategy: 'jwt',\r\n    maxAge: 30 * 24 * 60 * 60, // 30 days\r\n  },\r\n  secret: process.env.NEXTAUTH_SECRET,\r\n}"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAgBO,MAAM,cAA+B;IAC1C,WAAW;QACT,IAAA,uLAAmB,EAAC;YAClB,MAAM;YACN,aAAa;gBACX,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAO;gBAC5C,UAAU;oBAAE,OAAO;oBAAY,MAAM;gBAAW;YAClD;YACA,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,YAAY,CAAC,aAAa,UAAU;oBACpD,OAAO;gBACT;gBAEA,IAAI;oBACF,WAAW;oBACX,MAAM,QAAQ,MAAM,IAAA,iKAAY,EAC9B,yDACA;wBAAC,YAAY,QAAQ;qBAAC;oBAGxB,MAAM,OAAO,KAAK,CAAC,EAAE;oBAErB,IAAI,CAAC,QAAQ,CAAC,KAAK,QAAQ,EAAE;wBAC3B,OAAO;oBACT;oBAEA,kBAAkB;oBAClB,MAAM,UAAU,MAAM,gKAAM,CAAC,OAAO,CAAC,YAAY,QAAQ,EAAE,KAAK,QAAQ;oBAExE,IAAI,CAAC,SAAS;wBACZ,OAAO;oBACT;oBAEA,iBAAiB;oBACjB,MAAM,QAAQ,MAAM,IAAA,iKAAY,EAC9B,CAAC;;;gCAGmB,CAAC,EACrB;wBAAC,KAAK,EAAE;qBAAC;oBAGX,MAAM,YAAY,MAAM,GAAG,CAAC,CAAA,IAAK,EAAE,IAAI;oBAEvC,OAAO;wBACL,IAAI,KAAK,EAAE,CAAC,QAAQ;wBACpB,MAAM,KAAK,IAAI,IAAI,KAAK,QAAQ;wBAChC,OAAO,KAAK,KAAK,IAAI;wBACrB,UAAU,KAAK,QAAQ;wBACvB,OAAO;oBACT;gBACF,EAAE,OAAO,OAAO;oBACd,QAAQ,KAAK,CAAC,eAAe;oBAC7B,OAAO;gBACT;YACF;QACF;KACD;IACD,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,QAAQ,GAAG,KAAK,QAAQ;gBAC9B,MAAM,KAAK,GAAG,KAAK,KAAK;YAC1B;YACA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,QAAQ,GAAG,MAAM,QAAQ;gBACtC,QAAQ,IAAI,CAAC,KAAK,GAAG,MAAM,KAAK;gBAEhC,4BAA4B;gBAC5B,MAAM,YAAY,QAAQ,IAAI,CAAC,IAAI,EAAE,MAAM,QAAQ;oBAAC;iBAAI;gBACxD,QAAQ,IAAI,CAAC,QAAQ,GAAG,UAAU,MAAM,GAAG,IACvC,GAAG,SAAS,CAAC,EAAE,CAAC,EAAE,GAAG,SAAS,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC,WAAW,KAClD,SAAS,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,GAAG,WAAW;YAC9C;YACA,OAAO;QACT;IACF;IACA,OAAO;QACL,QAAQ;IACV;IACA,SAAS;QACP,UAAU;QACV,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,QAAQ,QAAQ,GAAG,CAAC,eAAe;AACrC","debugId":null}},
    {"offset": {"line": 314, "column": 0}, "map": {"version":3,"sources":["file:///users/mrzasa/projects/current/frontend2.4/lib/db/mysql-secondary.ts"],"sourcesContent":["import mysql from 'mysql2/promise'\r\n\r\nlet pool: mysql.Pool | null = null\r\n\r\nexport function getMySQLSecondaryPool() {\r\n  if (!pool) {\r\n    pool = mysql.createPool({\r\n      host: process.env.DB_MYSQL_SECONDARY_HOST,\r\n      port: parseInt(process.env.DB_MYSQL_SECONDARY_PORT || '3306'),\r\n      user: process.env.DB_MYSQL_SECONDARY_USER,\r\n      password: process.env.DB_MYSQL_SECONDARY_PASSWORD,\r\n      database: process.env.DB_MYSQL_SECONDARY_DATABASE,\r\n      waitForConnections: true,\r\n      connectionLimit: 10,\r\n      queueLimit: 0\r\n    })\r\n  }\r\n  return pool\r\n}\r\n\r\nexport async function querySecondary<T = any>(\r\n  sql: string,\r\n  params?: any[]\r\n): Promise<T> {\r\n  const pool = getMySQLSecondaryPool()\r\n  const [rows] = await pool.execute(sql, params)\r\n  return rows as T\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,IAAI,OAA0B;AAEvB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,gKAAK,CAAC,UAAU,CAAC;YACtB,MAAM,QAAQ,GAAG,CAAC,uBAAuB;YACzC,MAAM,SAAS,QAAQ,GAAG,CAAC,uBAAuB,IAAI;YACtD,MAAM,QAAQ,GAAG,CAAC,uBAAuB;YACzC,UAAU,QAAQ,GAAG,CAAC,2BAA2B;YACjD,UAAU,QAAQ,GAAG,CAAC,2BAA2B;YACjD,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;QACd;IACF;IACA,OAAO;AACT;AAEO,eAAe,eACpB,GAAW,EACX,MAAc;IAEd,MAAM,OAAO;IACb,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACvC,OAAO;AACT","debugId":null}},
    {"offset": {"line": 347, "column": 0}, "map": {"version":3,"sources":["file:///users/mrzasa/projects/current/frontend2.4/app/api/admin/job-notes/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\nimport { getServerSession } from 'next-auth'\nimport { authOptions } from '@/lib/auth'\nimport { querySecondary } from '@/lib/db/mysql-secondary'\n\n// Helper to parse date from day/month/year columns\nfunction parseDate(day: string | null, month: string | null, year: string | null): string | null {\n  if (!day || !month || !year) return null\n  \n  const monthMap: Record<string, string> = {\n    'Jan': '01', 'Feb': '02', 'Mar': '03', 'Apr': '04',\n    'May': '05', 'Jun': '06', 'Jul': '07', 'Aug': '08',\n    'Sep': '09', 'Oct': '10', 'Nov': '11', 'Dec': '12'\n  }\n  \n  const monthNum = monthMap[month] || month\n  const dayPadded = day.toString().padStart(2, '0')\n  \n  return `${year}-${monthNum}-${dayPadded}`\n}\n\n// Helper to extract date or \"Complete\" from notes field\n// Looks for patterns like [CAM: 10/10/2025] or [CAM: Complete]\nfunction extractDateFromNotes(notes: string, tag: string): { date: string | null; complete: boolean } {\n  if (!notes) return { date: null, complete: false }\n  \n  // Match pattern like [TAG: value] or [TAG:value]\n  const regex = new RegExp(`\\\\[${tag}:\\\\s*([^\\\\]]+)\\\\]`, 'i')\n  const match = notes.match(regex)\n  \n  if (!match) return { date: null, complete: false }\n  \n  const value = match[1].trim()\n  \n  if (value.toLowerCase() === 'complete') {\n    return { date: null, complete: true }\n  }\n  \n  // Try to parse as date (MM/DD/YYYY format)\n  const dateMatch = value.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/)\n  if (dateMatch) {\n    const [, month, day, year] = dateMatch\n    return {\n      date: `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`,\n      complete: false\n    }\n  }\n  \n  return { date: null, complete: false }\n}\n\n// Helper to extract section text and hold info from notes\n// Looks for [TAG] followed by text until the next [TAG] or end\n// Also parses [Owner: X; Target: Y; Action: Z] within the section\n// And parses [On Hold: date] and [Days On Hold: X]\nfunction extractSectionFromNotes(notes: string, tag: string): {\n  text: string\n  hasHold: boolean\n  owner: string | null\n  target: string | null\n  action: string | null\n  onHoldDate: string | null\n  daysOnHold: number\n} {\n  if (!notes) return { text: '', hasHold: false, owner: null, target: null, action: null, onHoldDate: null, daysOnHold: 0 }\n  \n  // Find the section starting with [TAG]\n  const sectionRegex = new RegExp(`\\\\[${tag}\\\\]\\\\s*([\\\\s\\\\S]*?)(?=\\\\n\\\\[(?!Owner|On Hold|Days On Hold)|$)`, 'i')\n  const sectionMatch = notes.match(sectionRegex)\n  \n  if (!sectionMatch) return { text: '', hasHold: false, owner: null, target: null, action: null, onHoldDate: null, daysOnHold: 0 }\n  \n  let sectionText = sectionMatch[1].trim()\n  \n  // Check for hold information: [Owner: X; Target: Y; Action: Z]\n  const holdRegex = /\\[Owner:\\s*([^;]+);\\s*Target:\\s*([^;]+);\\s*Action:\\s*([^\\]]+)\\]/i\n  const holdMatch = sectionText.match(holdRegex)\n  \n  let owner: string | null = null\n  let target: string | null = null\n  let action: string | null = null\n  let hasHold = false\n  \n  if (holdMatch) {\n    hasHold = true\n    owner = holdMatch[1].trim()\n    \n    // Parse target date (MM/DD/YYYY format)\n    const targetStr = holdMatch[2].trim()\n    const targetDateMatch = targetStr.match(/^(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})/)\n    if (targetDateMatch) {\n      const [, month, day, year] = targetDateMatch\n      target = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`\n    }\n    \n    action = holdMatch[3].trim()\n    \n    // Remove the hold bracket from the text for cleaner display\n    sectionText = sectionText.replace(holdRegex, '').trim()\n  }\n  \n  // Parse [On Hold: MM/DD/YYYY]\n  let onHoldDate: string | null = null\n  const onHoldRegex = /\\[On Hold:\\s*(\\d{1,2})\\/(\\d{1,2})\\/(\\d{4})\\]/i\n  const onHoldMatch = sectionText.match(onHoldRegex)\n  if (onHoldMatch) {\n    const [, month, day, year] = onHoldMatch\n    onHoldDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`\n    sectionText = sectionText.replace(onHoldRegex, '').trim()\n  }\n  \n  // Parse [Days On Hold: X]\n  let daysOnHold = 0\n  const daysOnHoldRegex = /\\[Days On Hold:\\s*(\\d+)\\]/i\n  const daysOnHoldMatch = sectionText.match(daysOnHoldRegex)\n  if (daysOnHoldMatch) {\n    daysOnHold = parseInt(daysOnHoldMatch[1], 10)\n    sectionText = sectionText.replace(daysOnHoldRegex, '').trim()\n  }\n  \n  // Clean up the text - remove extra whitespace and newlines\n  sectionText = sectionText.replace(/\\s+/g, ' ').trim()\n  \n  return { text: sectionText, hasHold, owner, target, action, onHoldDate, daysOnHold }\n}\n\nexport type JobStatusNote = {\n  id: number\n  job_id: number\n  timestamp: number\n  timestampFormatted: string\n  notes: string\n  hdw_date: string | null\n  bom_date: string | null\n  cam_date: string | null\n  cam_complete: boolean\n  rev_date: string | null\n  rev_complete: boolean\n  prl_date: string | null  // PCB Week\n  arl_date: string | null  // ASM Week\n  // Section text and hold info\n  hdw_text: string\n  hdw_hold: { hasHold: boolean; owner: string | null; target: string | null; action: string | null; onHoldDate: string | null; daysOnHold: number }\n  pcb_text: string\n  pcb_hold: { hasHold: boolean; owner: string | null; target: string | null; action: string | null; onHoldDate: string | null; daysOnHold: number }\n  asm_text: string\n  asm_hold: { hasHold: boolean; owner: string | null; target: string | null; action: string | null; onHoldDate: string | null; daysOnHold: number }\n}\n\n// GET - Fetch job status notes by job name\nexport async function GET(request: NextRequest) {\n  const session = await getServerSession(authOptions)\n  \n  if (!session) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  try {\n    const { searchParams } = new URL(request.url)\n    const jobName = searchParams.get('jobName')\n\n    if (!jobName) {\n      return NextResponse.json(\n        { error: 'jobName parameter is required' },\n        { status: 400 }\n      )\n    }\n\n    const query = `\n      SELECT \n        umj.id,\n        umj.job_id,\n        umj.notes,\n        umj.time_stamp,\n        umj.hdw_comp_day,\n        umj.hdw_comp_month,\n        umj.hdw_comp_year,\n        umj.bom_comp_day,\n        umj.bom_comp_month,\n        umj.bom_comp_year,\n        umj.pcb_comp_day,\n        umj.pcb_comp_month,\n        umj.pcb_comp_year,\n        umj.asm_comp_day,\n        umj.asm_comp_month,\n        umj.asm_comp_year\n      FROM job \n      JOIN umr_job_status_notes umj ON job.id = umj.job_id\n      WHERE job.name = ?\n      ORDER BY umj.time_stamp DESC\n    `\n\n    const results = await querySecondary(query, [jobName])\n\n    // Transform results\n    const notes: JobStatusNote[] = (results as any[]).map(row => {\n      const cam = extractDateFromNotes(row.notes, 'CAM')\n      const rev = extractDateFromNotes(row.notes, 'Rev')\n      \n      // Extract section text and hold info\n      const hdwSection = extractSectionFromNotes(row.notes, 'HDW')\n      const pcbSection = extractSectionFromNotes(row.notes, 'PCB')\n      const asmSection = extractSectionFromNotes(row.notes, 'ASM')\n      \n      // Format timestamp\n      const timestampMs = row.time_stamp * 1000\n      const timestampDate = new Date(timestampMs)\n      const timestampFormatted = timestampDate.toLocaleDateString('en-US', {\n        month: 'short',\n        day: 'numeric',\n        year: 'numeric',\n        hour: '2-digit',\n        minute: '2-digit'\n      })\n\n      return {\n        id: row.id,\n        job_id: row.job_id,\n        timestamp: row.time_stamp,\n        timestampFormatted,\n        notes: row.notes || '',\n        hdw_date: parseDate(row.hdw_comp_day, row.hdw_comp_month, row.hdw_comp_year),\n        bom_date: parseDate(row.bom_comp_day, row.bom_comp_month, row.bom_comp_year),\n        cam_date: cam.date,\n        cam_complete: cam.complete,\n        rev_date: rev.date,\n        rev_complete: rev.complete,\n        prl_date: parseDate(row.pcb_comp_day, row.pcb_comp_month, row.pcb_comp_year),\n        arl_date: parseDate(row.asm_comp_day, row.asm_comp_month, row.asm_comp_year),\n        hdw_text: hdwSection.text,\n        hdw_hold: { hasHold: hdwSection.hasHold, owner: hdwSection.owner, target: hdwSection.target, action: hdwSection.action, onHoldDate: hdwSection.onHoldDate, daysOnHold: hdwSection.daysOnHold },\n        pcb_text: pcbSection.text,\n        pcb_hold: { hasHold: pcbSection.hasHold, owner: pcbSection.owner, target: pcbSection.target, action: pcbSection.action, onHoldDate: pcbSection.onHoldDate, daysOnHold: pcbSection.daysOnHold },\n        asm_text: asmSection.text,\n        asm_hold: { hasHold: asmSection.hasHold, owner: asmSection.owner, target: asmSection.target, action: asmSection.action, onHoldDate: asmSection.onHoldDate, daysOnHold: asmSection.daysOnHold },\n      }\n    })\n\n    return NextResponse.json({\n      success: true,\n      jobName,\n      count: notes.length,\n      notes\n    })\n\n  } catch (error) {\n    console.error('Job Notes API Error:', error)\n    return NextResponse.json(\n      { \n        error: 'Failed to fetch job notes', \n        details: error instanceof Error ? error.message : String(error) \n      },\n      { status: 500 }\n    )\n  }\n}\n\n// POST - Create new job status note (for future use)\nexport async function POST(request: NextRequest) {\n  const session = await getServerSession(authOptions)\n  \n  if (!session) {\n    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n  }\n\n  try {\n    const body = await request.json()\n    const { \n      jobName, \n      notes,\n      hdw_date,\n      bom_date,\n      prl_date,\n      arl_date\n    } = body\n\n    if (!jobName) {\n      return NextResponse.json(\n        { error: 'jobName is required' },\n        { status: 400 }\n      )\n    }\n\n    // First get the job_id\n    const jobQuery = `SELECT id FROM job WHERE name = ? LIMIT 1`\n    const jobResults = await querySecondary(jobQuery, [jobName]) as any[]\n    \n    if (jobResults.length === 0) {\n      return NextResponse.json(\n        { error: 'Job not found' },\n        { status: 404 }\n      )\n    }\n\n    const jobId = jobResults[0].id\n\n    // Parse dates into day/month/year\n    const parseDateParts = (dateStr: string | null) => {\n      if (!dateStr) return { day: null, month: null, year: null }\n      const date = new Date(dateStr)\n      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']\n      return {\n        day: date.getDate().toString().padStart(2, '0'),\n        month: months[date.getMonth()],\n        year: date.getFullYear().toString()\n      }\n    }\n\n    const hdw = parseDateParts(hdw_date)\n    const bom = parseDateParts(bom_date)\n    const prl = parseDateParts(prl_date)\n    const arl = parseDateParts(arl_date)\n\n    const insertQuery = `\n      INSERT INTO umr_job_status_notes (\n        job_id, notes, time_stamp,\n        hdw_comp_day, hdw_comp_month, hdw_comp_year,\n        bom_comp_day, bom_comp_month, bom_comp_year,\n        pcb_comp_day, pcb_comp_month, pcb_comp_year,\n        asm_comp_day, asm_comp_month, asm_comp_year\n      ) VALUES (?, ?, UNIX_TIMESTAMP(), ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n    `\n\n    await querySecondary(insertQuery, [\n      jobId,\n      notes || '',\n      hdw.day, hdw.month, hdw.year,\n      bom.day, bom.month, bom.year,\n      prl.day, prl.month, prl.year,\n      arl.day, arl.month, arl.year\n    ])\n\n    return NextResponse.json({\n      success: true,\n      message: 'Job status note created'\n    })\n\n  } catch (error) {\n    console.error('Job Notes POST Error:', error)\n    return NextResponse.json(\n      { \n        error: 'Failed to create job note', \n        details: error instanceof Error ? error.message : String(error) \n      },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}