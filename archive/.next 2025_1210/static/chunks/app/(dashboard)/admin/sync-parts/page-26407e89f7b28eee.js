(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[223],{624:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>d});var t=a(5155),r=a(2115),l=a(2173),i=a(7036);let n=(0,a(1858).A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);function d(){let[e,s]=(0,r.useState)(!1),[a,d]=(0,r.useState)(!1),[c,o]=(0,r.useState)(null),[h,m]=(0,r.useState)(new Set),[p,x]=(0,r.useState)(new Map),f=async()=>{s(!0),o(null),m(new Set),x(new Map);try{let e=await fetch("/api/admin/sync-parts");if(!e.ok)throw Error("Failed to scan and compare");let s=await e.json();o(s);let a=s.comparisons.filter(e=>e.existsInDB);m(new Set(a.map(e=>e.apcPN)));let t=new Map;a.forEach(e=>{let s=e.differences.filter(e=>e.isDifferent).map(e=>e.field);t.set(e.apcPN,new Set(s))}),x(t)}catch(e){console.error("Error scanning:",e),alert("Failed to scan and compare. Check console for details.")}finally{s(!1)}},u=async()=>{if(c&&0!==h.size){d(!0);try{let e=c.comparisons.filter(e=>h.has(e.apcPN)&&e.existsInDB).map(e=>{let s=p.get(e.apcPN)||new Set,a={apcPN:e.apcPN,dbId:e.dbId};return e.differences.forEach(e=>{s.has(e.field)&&(a[e.field]=e.folderValue)}),a}),s=await fetch("/api/admin/sync-parts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({updates:e})});if(!s.ok)throw Error("Failed to sync");let a=await s.json();alert(`Sync complete!
Updated: ${a.updated}
Errors: ${a.errors.length}`),f()}catch(e){console.error("Error syncing:",e),alert("Failed to sync. Check console for details.")}finally{d(!1)}}};return(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Sync Parts"}),(0,t.jsx)("p",{className:"text-slate-600 mb-6",children:"Compare folder data with database and sync differences"}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{onClick:f,disabled:e,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{size:18,className:"animate-spin"}),"Scanning..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{size:18}),"Scan & Compare"]})}),c&&c.mismatches>0&&(0,t.jsx)("button",{onClick:u,disabled:a||0===h.size,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.A,{size:18,className:"animate-spin"}),"Syncing..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.A,{size:18}),"Sync Selected (",h.size,")"]})})]}),c&&(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,t.jsxs)("span",{className:"text-slate-600",children:["Total: ",c.total]}),(0,t.jsxs)("span",{className:"text-orange-600 font-semibold",children:["Mismatches: ",c.mismatches]}),(0,t.jsxs)("span",{className:"text-green-600",children:["New: ",c.newParts]})]})]}),(0,t.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:[(0,t.jsx)(n,{className:"text-orange-600 flex-shrink-0 mt-0.5",size:18}),(0,t.jsxs)("div",{className:"text-sm text-orange-800",children:[(0,t.jsx)("strong",{children:"Warning:"})," This will overwrite database values with folder information. Review carefully before syncing. Select which fields to update for each part."]})]})})]}),c&&c.comparisons.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,t.jsx)("div",{className:"p-6 border-b border-slate-200",children:(0,t.jsxs)("h3",{className:"font-semibold text-slate-800",children:["Parts with Differences (",c.comparisons.filter(e=>e.existsInDB).length,")"]})}),(0,t.jsx)("div",{className:"divide-y divide-slate-200",children:c.comparisons.filter(e=>e.existsInDB).map(e=>(0,t.jsx)("div",{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-start gap-4",children:[(0,t.jsx)("input",{type:"checkbox",checked:h.has(e.apcPN),onChange:()=>{var s;let a;return s=e.apcPN,void((a=new Set(h)).has(s)?a.delete(s):a.add(s),m(a))},className:"mt-1 rounded border-slate-300"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-mono font-semibold text-slate-800",children:e.apcPN}),(0,t.jsx)("p",{className:"text-sm text-slate-500",children:e.folderName})]})}),(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.differences.filter(e=>e.isDifferent).map(s=>{var a;let r=p.get(e.apcPN)?.has(s.field);return(0,t.jsxs)("div",{className:`border rounded-lg p-3 ${r?"border-orange-300 bg-orange-50":"border-slate-200"}`,children:[(0,t.jsxs)("div",{className:"flex items-start gap-2 mb-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:r,onChange:()=>{var a,t;let r,l;return a=e.apcPN,t=s.field,void((l=(r=new Map(p)).get(a)||new Set).has(t)?l.delete(t):l.add(t),r.set(a,l),x(r))},className:"mt-1 rounded border-slate-300"}),(0,t.jsx)("label",{className:"text-sm font-medium text-slate-700",children:{customer:"Customer",customerPN:"Customer PN",currentRev:"Revision",fullPath:"Path"}[a=s.field]||a})]}),(0,t.jsxs)("div",{className:"ml-6 space-y-1 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-500",children:"DB:"})," ",(0,t.jsx)("span",{className:"text-red-600",children:s.dbValue||"(empty)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-slate-500",children:"Folder:"})," ",(0,t.jsx)("span",{className:"text-green-600",children:s.folderValue||"(empty)"})]})]})]},s.field)})})]})]})},e.apcPN))})]}),c&&0===c.comparisons.length&&(0,t.jsx)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:(0,t.jsx)("p",{className:"text-slate-500",children:"No differences found. Database is in sync with folders! âœ“"})}),!c&&!e&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-12 text-center",children:[(0,t.jsx)(l.A,{className:"mx-auto text-slate-300 mb-4",size:64}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-slate-800 mb-2",children:"No Comparison Results"}),(0,t.jsx)("p",{className:"text-slate-600",children:'Click "Scan & Compare" to find differences between folders and database'})]})]})}},1858:(e,s,a)=>{"use strict";a.d(s,{A:()=>d});var t=a(2115);let r=e=>{let s=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,a)=>a?a.toUpperCase():s.toLowerCase());return s.charAt(0).toUpperCase()+s.slice(1)},l=(...e)=>e.filter((e,s,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===s).join(" ").trim();var i={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:s=24,strokeWidth:a=2,absoluteStrokeWidth:r,className:n="",children:d,iconNode:c,...o},h)=>(0,t.createElement)("svg",{ref:h,...i,width:s,height:s,stroke:e,strokeWidth:r?24*Number(a)/Number(s):a,className:l("lucide",n),...!d&&!(e=>{for(let s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0})(o)&&{"aria-hidden":"true"},...o},[...c.map(([e,s])=>(0,t.createElement)(e,s)),...Array.isArray(d)?d:[d]])),d=(e,s)=>{let a=(0,t.forwardRef)(({className:a,...i},d)=>(0,t.createElement)(n,{ref:d,iconNode:s,className:l(`lucide-${r(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${e}`,a),...i}));return a.displayName=r(e),a}},2173:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1858).A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},3078:(e,s,a)=>{Promise.resolve().then(a.bind(a,624))},7036:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(1858).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])}},e=>{e.O(0,[441,826,358],()=>e(e.s=3078)),_N_E=e.O()}]);